<!DOCTYPE html>
<html>
<head>
    <title></title>
    <script src="src/NodeNotFoundException.js"></script>
    <script src="src/ToFewParametersPassedAsArgument.js"></script>
    <script src="src/Node.js"></script>
    <script src="src/Graph.js"></script>

    <script src="lib/jquery-1.7.2.js"></script>
    <script src="lib/bootstrap/js/bootstrap.js"></script>

    <link rel="stylesheet" href="lib/bootstrap/css/bootstrap.css"/>
    <link rel="stylesheet" href="lib/bootstrap/css/bootstrap-responsive.css"/>

</head>
<body>
<div class="container">

    <form>
        <label for="child">Input command (add, find):</label>
        <span id="operation" class="label" style="display: none;"></span>
        <input type="text" id="child" autocomplete="off"/>
        <span id="prefix" class="label" style="display: none;">to</span>
        <input type="text" id="parent" autocomplete="off" style="display: none;"/>
    </form>

    <span id="caption"></span>
    <ul id="tree"></ul>
</div>


<script>
    $(document).ready(function () {
        $(window).keydown(function (event) {
            if (event.keyCode == 13) {
                event.preventDefault();
                return false;
            }
            return true;
        });
    });
    var graph = new Graph();
    graph.addNode("milk");
    graph.addNode("milk", "water");
    graph.addNode("water", "water1");
    graph.addNode("water", "water2");
    graph.addNode("water", "water3");
    graph.addNode("water", "water4");
    graph.addNode("milk", "sugar");
    graph.addNode("milk", "coc");
    graph.addNode("milk", "mcoc");

    var selectChildNode = function (query) {
        var result = [];
        (function () {
            try {
                var search = graph.search(query);
            } catch (e) {
                if (e.name === "NodeNotFoundException") {
                    result = [];
                    return;
                }
            }

            for (var i in search) {
                result.push(search[i].getName());
            }
        })();
        console.log(result);
        return result;
    }

    $('#child').change(function () {
        var request = $('#child').val();
        console.log(request);
        var search = request.search("&lt;");
        console.log(search);
        if (currentCommand == "find") {
            showChildren(request);
            $("#operation").hide();
            $("#child").val("");
            currentCommand = "";
            return true;
        }

        //determine operation type
        if (request[0] == "a") {
            $('#operation').html("add");
            $('#operation').show();
            $('#parent').show();
            $('#prefix').show();
            $('#child').val("");
            currentCommand = "add";
        } else if (request[0] == "f") {
            $('#operation').html("find");
            $('#operation').show();
            var request = $('#child').val();
            $('#child').val("");
            currentCommand = "find";
        } else if (request[0] == "r") {
            $('#operation').html("remove");
            $('#operation').show();
            $('#child').val("");
            currentCommand = "remove";
        }

    });

    $('#parent').change(function () {
        var child = $("#child").val();
        var parent = $("#parent").val();
        try {
            graph.addNode(parent, child);
        } catch (e) {
            if (e.name === NodeNotFoundException.name) {
                $("#caption").html("<span class='label label-important'>Node with this name does not exists!</span>");
            }
        }
        $("#caption").html("<span class='label label-info'>Node &lt;" + child + "&gt; was added to &lt;" + parent + "&gt;</span>");
        $('#child').val("");
        $('#operation').hide();
        $('#prefix').hide();
        $('#parent').hide();
        currentCommand = "";
    });

    var currentCommand = "";

    $('#child').typeahead({source:function (query) {
        return (function () {
            if (currentCommand === "") {
                return  ["add &lt;node&gt; &lt;parent&gt;", "remove &lt;node&gt;", "find &lt;node&gt;"];
            } else {
                return selectChildNode(query);
            }
        }());
    }});

    $('#parent').typeahead({source:selectChildNode});

    var showChildren = function (query) {
        console.log(1);
        $("#tree").html("");
        try {
            var search = graph.search(query);
            console.log(search);
            if (search && !(search instanceof Array)) {
                var childNames = search.getChildNames();
                if (childNames.length > 0) {
                    $("#caption").html(
                            "Child of " +
                                    "<span class='label label-success'>" + query + "</span>" +
                                    " is :"
                    );
                    for (var k in childNames)
                        $("#tree").append("<li> <span class='label label-warning'>" + childNames[k] + "</span></li>");
                } else {
                    var parentNodes = search.getParentNames();
                    $("#caption").html(
                            "Parent of " +
                                    "<span class='label label-warning'>" + query + "</span>" +
                                    " is : " +
                                    "<span class='label label-success'>" + parentNodes[0] + "</span>"
                    );
                }
            } else {
                $("#caption").html("<span class='label label-important'>Node name " + query + " is incorrect!</span>");
            }
        } catch (e) {
            if (e.name === NodeNotFoundException.name) {
                $("#caption").html("<span class='label label-important'>Node with this name does not exists!</span>");
            }
        }


    };
</script>

</body>
</html>